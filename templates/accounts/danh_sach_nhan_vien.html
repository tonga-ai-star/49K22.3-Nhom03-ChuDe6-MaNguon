{% extends 'base.html' %}

{% block title %}Qu·∫£n l√Ω nh√¢n vi√™n{% endblock %}
{% block page_title %}üë• Qu·∫£n l√Ω nh√¢n vi√™n{% endblock %}

{% block content %}
<!-- Th·ªëng k√™ nhanh -->
<div class="row mb-4">
    <div class="col-xl-4 col-md-6 mb-4">
        <div class="card stat-card bg-primary text-white">
            <div class="card-body">
                <div class="d-flex justify-content-between">
                    <div>
                        <div class="text-uppercase mb-1">T·ªïng nh√¢n vi√™n</div>
                        <div class="h4">{{ tong_nhan_vien }}</div>
                    </div>
                    <i class="fas fa-users fa-2x opacity-50"></i>
                </div>
            </div>
        </div>
    </div>

    <div class="col-xl-4 col-md-6 mb-4">
        <div class="card stat-card bg-success text-white">
            <div class="card-body">
                <div class="d-flex justify-content-between">
                    <div>
                        <div class="text-uppercase mb-1">ƒêang l√†m vi·ªác</div>
                        <div class="h4">{{ nhan_vien_dang_lam }}</div>
                    </div>
                    <i class="fas fa-user-check fa-2x opacity-50"></i>
                </div>
            </div>
        </div>
    </div>

    <div class="col-xl-4 col-md-6 mb-4">
        <div class="card stat-card bg-warning text-white">
            <div class="card-body">
                <div class="d-flex justify-content-between">
                    <div>
                        <div class="text-uppercase mb-1">ƒê√£ ngh·ªâ vi·ªác</div>
                        <div class="h4">{{ nhan_vien_nghi_viec }}</div>
                    </div>
                    <i class="fas fa-user-times fa-2x opacity-50"></i>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- B·ªô l·ªçc v√† t√¨m ki·∫øm -->
<div class="card mb-4">
    <div class="card-body">
        <h6 class="card-title">üîç T√¨m ki·∫øm & L·ªçc</h6>
        <form method="get" class="row g-3">
            <div class="col-md-4">
                <input type="text" name="q" class="form-control" placeholder="T√¨m theo t√™n, username ho·∫∑c email..." value="{{ search_query }}">
            </div>
            <div class="col-md-3">
                <select name='vai_tro' class="form-select">
                    <option value="">T·∫•t c·∫£ vai tr√≤</option>
                    <option value='manager' {% if selected_vai_tro == 'manager' %}selected{% endif %}>Qu·∫£n l√Ω</option>
                    <option value='staff' {% if selected_vai_tro == 'staff' %}selected{% endif %}>Nh√¢n vi√™n</option>
                </select>
            </div>
            <div class="col-md-3">
                <select name="trang_thai" class="form-select">
                    <option value="">T·∫•t c·∫£ tr·∫°ng th√°i</option>
                    <option value="true" {% if selected_trang_thai == 'true' %}selected{% endif %}>ƒêang l√†m</option>
                    <option value="false" {% if selected_trang_thai == 'false' %}selected{% endif %}>Ngh·ªâ vi·ªác</option>
                </select>
            </div>
            <div class="col-md-2">
                <button type="submit" class="btn btn-primary w-100">
                    <i class="fas fa-search me-2"></i>T√¨m
                </button>
            </div>
        </form>
    </div>
</div>

<!-- B·∫£ng danh s√°ch nh√¢n vi√™n -->
<div class="card table-custom">
    <div class="card-header d-flex justify-content-between align-items-center">
        <h6 class="card-title mb-0">üìã Danh s√°ch nh√¢n vi√™n</h6>
        <a href="{% url 'them_nhan_vien' %}" class="btn btn-primary-custom btn-sm">
            <i class="fas fa-plus me-2"></i>Th√™m nh√¢n vi√™n
        </a>
    </div>
    <div class="card-body">
        <div class="table-responsive">
            <table class="table table-hover table-sm">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>H·ªç t√™n</th>
                        <th>T√™n ƒëƒÉng nh·∫≠p</th>
                        <th>Vai tr√≤</th>
                        <th>Email</th>
                        <th>Ng√†y tham gia</th>
                        <th>Tr·∫°ng th√°i</th>
                        <th class="text-center" width="120">Thao t√°c</th>
                    </tr>
                </thead>
                <tbody>
                    {% for nv in nhan_vien_list %}
                    <tr>
                        <td>{{ forloop.counter }}</td>
                        <td>
                            <strong>{{ nv.ho_ten|default:nv.username }}</strong>
                        </td>
                        <td>{{ nv.username }}</td>
                        <td>
                            {% if nv.vai_tro == 'admin' %}
                                <span class="badge bg-danger">Qu·∫£n tr·ªã</span>
                            {% elif nv.vai_tro == 'manager' %}
                                <span class="badge bg-warning">Qu·∫£n l√Ω</span>
                            {% else %}
                                <span class="badge bg-secondary">Nh√¢n vi√™n</span>
                            {% endif %}
                        </td>
                        <td>{{ nv.email|default:"-" }}</td>
                        <td>{{ nv.date_joined|date:"d/m/Y" }}</td>
                        <td>
                            {% if nv.trang_thai %}
                                <span class="badge bg-success">ƒêang l√†m</span>
                            {% else %}
                                <span class="badge bg-danger">Ngh·ªâ vi·ªác</span>
                            {% endif %}
                        </td>
                        <td class="text-center">
                            <div class="d-flex justify-content-center gap-2">
                                <!-- N√∫t Xem chi ti·∫øt -->
                                <a href="{% url 'chi_tiet_nhan_vien' nv.id %}"
                                   class="btn btn-sm btn-outline-primary d-flex align-items-center justify-content-center action-btn"
                                   data-bs-toggle="tooltip" title="Xem chi ti·∫øt">
                                    <i class="fas fa-eye"></i>
                                </a>

                                <!-- N√∫t S·ª≠a -->
                                <a href="{% url 'sua_nhan_vien' nv.id %}"
                                   class="btn btn-sm btn-outline-warning d-flex align-items-center justify-content-center action-btn"
                                   data-bs-toggle="tooltip" title="S·ª≠a th√¥ng tin">
                                    <i class="fas fa-edit"></i>
                                </a>

                                <!-- N√∫t X√≥a (ch·ªâ hi·ªÉn th·ªã n·∫øu kh√¥ng ph·∫£i ng∆∞·ªùi d√πng hi·ªán t·∫°i) -->
                                {% if nv.id != request.user.id %}
                                <a href="{% url 'xoa_nhan_vien' nv.id %}"
                                   class="btn btn-sm btn-outline-danger d-flex align-items-center justify-content-center action-btn"
                                   data-bs-toggle="tooltip" title="X√≥a nh√¢n vi√™n"
                                   onclick="return confirmDelete('{{ nv.username }}')">
                                    <i class="fas fa-trash"></i>
                                </a>
                                {% else %}
                                <!-- N√∫t disabled n·∫øu l√† ng∆∞·ªùi d√πng hi·ªán t·∫°i -->
                                <button class="btn btn-sm btn-outline-secondary d-flex align-items-center justify-content-center action-btn"
                                        disabled
                                        data-bs-toggle="tooltip" title="Kh√¥ng th·ªÉ x√≥a ch√≠nh m√¨nh">
                                    <i class="fas fa-trash"></i>
                                </button>
                                {% endif %}
                            </div>
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="8" class="text-center text-muted py-4">
                            <i class="fas fa-users fa-2x mb-2"></i>
                            <br>Kh√¥ng t√¨m th·∫•y nh√¢n vi√™n n√†o
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<style>
.stat-card {
    border: none;
    border-radius: 10px;
    transition: transform 0.2s;
}

.stat-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 20px rgba(0,0,0,0.1);
}

.table-custom {
    border: none;
    box-shadow: 0 0.15rem 1.75rem 0 rgba(58, 59, 69, 0.1);
    border-radius: 10px;
}

.btn-primary-custom {
    background-color: #4e73df;
    border-color: #4e73df;
    color: white;
    transition: all 0.2s;
}

.btn-primary-custom:hover {
    background-color: #3a5ec0;
    border-color: #3a5ec0;
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
}

/* N√∫t thao t√°c - ƒê·ªíNG B·ªò V·ªöI C√ÅC TEMPLATE TR∆Ø·ªöC */
.action-btn {
    width: 36px !important;
    height: 36px !important;
    padding: 0 !important;
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
    border-radius: 0.375rem !important;
    border-width: 1px !important;
    transition: all 0.2s !important;
}

.action-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
}

/* M√†u s·∫Øc n√∫t */
.btn-outline-primary {
    color: #4e73df;
    border-color: #4e73df;
}

.btn-outline-primary:hover {
    background-color: #4e73df;
    color: white;
}

.btn-outline-warning {
    color: #f6c23e;
    border-color: #f6c23e;
}

.btn-outline-warning:hover {
    background-color: #f6c23e;
    color: #000;
}

.btn-outline-danger {
    color: #e74a3b;
    border-color: #e74a3b;
}

.btn-outline-danger:hover {
    background-color: #e74a3b;
    color: white;
}

.btn-outline-secondary {
    color: #6c757d;
    border-color: #6c757d;
    cursor: not-allowed;
}

.btn-outline-secondary:hover {
    background-color: transparent;
    color: #6c757d;
    transform: none;
    box-shadow: none;
}

/* Kho·∫£ng c√°ch gi·ªØa c√°c n√∫t */
.gap-2 {
    gap: 0.5rem;
}

/* Responsive */
@media (max-width: 768px) {
    .action-btn {
        width: 32px !important;
        height: 32px !important;
    }

    .table th, .table td {
        padding: 0.5rem 0.25rem;
        font-size: 0.85rem;
    }
}

@media (max-width: 576px) {
    .action-btn {
        width: 28px !important;
        height: 28px !important;
        font-size: 0.75rem;
    }

    .gap-2 {
        gap: 0.25rem;
    }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // K√≠ch ho·∫°t tooltip Bootstrap
    var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
    var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
        return new bootstrap.Tooltip(tooltipTriggerEl);
    });
});

// H√†m x√°c nh·∫≠n x√≥a nh√¢n vi√™n
function confirmDelete(username) {
    return confirm(`B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a nh√¢n vi√™n "${username}"?\n\n‚ö†Ô∏è C·∫£nh b√°o: H√†nh ƒë·ªông n√†y kh√¥ng th·ªÉ ho√†n t√°c!`);
}
</script>
{% endblock %}