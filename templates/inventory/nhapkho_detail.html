{% extends 'base.html' %}
{% load static %}
{% load humanize %}

{% block title %}Chi ti·∫øt phi·∫øu nh·∫≠p{% endblock %}
{% block page_title %}üìã Chi ti·∫øt phi·∫øu nh·∫≠p {{ phieu_nhap.ma_phieu }}{% endblock %}

{% block content %}
<div class="card shadow-sm border-0">
    <div class="card-header d-flex justify-content-between align-items-center bg-primary text-white">
        <h5 class="mb-0"><i class="fas fa-file-invoice me-2"></i>Th√¥ng tin phi·∫øu nh·∫≠p</h5>
        <div>
            <a href="{% url 'inventory:nhapkho_list' %}" class="btn btn-light btn-sm">
                <i class="fas fa-arrow-left me-1"></i>Quay l·∫°i danh s√°ch
            </a>
        </div>
    </div>

    <div class="card-body">
        <!-- Th√¥ng tin phi·∫øu nh·∫≠p -->
        <div class="row mb-4">
            <div class="col-md-6">
                <p><strong>M√£ phi·∫øu:</strong> <span class="text-primary">{{ phieu_nhap.ma_phieu }}</span></p>
                <p><strong>Ng√†y nh·∫≠p:</strong> {{ phieu_nhap.ngay_nhap|date:"d/m/Y H:i" }}</p>
                <p><strong>Ng∆∞·ªùi l·∫≠p:</strong> {{ phieu_nhap.nguoi_lap.username }}</p>
            </div>
            <div class="col-md-6">
                <p><strong>Nh√† cung c·∫•p:</strong> {{ phieu_nhap.nha_cung_cap.ten_nha_cung_cap }}</p>
                <p><strong>Kho nh·∫≠p:</strong> {{ phieu_nhap.kho.ten_kho }}</p>
                <p><strong>Ghi ch√∫:</strong> {{ phieu_nhap.ghi_chu|default:"Kh√¥ng c√≥" }}</p>
            </div>
        </div>

        <!-- Chi ti·∫øt s·∫£n ph·∫©m -->
        <h5 class="mt-3 mb-3"><i class="fas fa-boxes me-2 text-success"></i>Chi ti·∫øt s·∫£n ph·∫©m</h5>
        <div class="table-responsive">
            <table class="table table-hover align-middle">
                <thead class="table-light">
                    <tr>
                        <th>#</th>
                        <th>S·∫£n ph·∫©m</th>
                        <th class="text-center">S·ªë l∆∞·ª£ng</th>
                        <th class="text-end">ƒê∆°n gi√°</th>
                        <th class="text-end">Th√†nh ti·ªÅn</th>
                    </tr>
                </thead>
                <tbody>
                    {% for ct in chi_tiet_list %}
                    <tr>
                        <td>{{ forloop.counter }}</td>
                        <td>{{ ct.san_pham.ten_san_pham }}</td>
                        <td class="text-center">{{ ct.so_luong }}</td>
                        <td class="text-end">{{ ct.don_gia|floatformat:0|intcomma }}‚Ç´</td>
                        <td class="text-end fw-bold text-success">{{ ct.thanh_tien|floatformat:0|intcomma }}‚Ç´</td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="5" class="text-center text-muted py-4">
                            <i class="fas fa-box-open fa-2x mb-2 opacity-50"></i><br>
                            Ch∆∞a c√≥ s·∫£n ph·∫©m n√†o trong phi·∫øu nh·∫≠p n√†y.
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
                {% if chi_tiet_list %}
                <tfoot class="table-light">
                    <tr>
                        <td colspan="4" class="text-end"><strong>T·ªïng c·ªông:</strong></td>
                        <td class="text-end">
                            <h5 class="text-success fw-bold mb-0">{{ tong_tien|floatformat:0|intcomma }}‚Ç´</h5>
                        </td>
                    </tr>
                </tfoot>
                {% endif %}
            </table>
        </div>

        <div class="d-flex justify-content-end mt-4 gap-3">
            <!-- N√∫t Quay l·∫°i -->
            <a href="{% url 'inventory:nhapkho_list' %}"
               class="btn btn-outline-secondary d-flex align-items-center justify-content-center action-btn-detail">
                <i class="fas fa-arrow-left me-2"></i>
                <span>Quay l·∫°i</span>
            </a>

            <!-- N√∫t In phi·∫øu -->
            <button class="btn btn-warning d-flex align-items-center justify-content-center action-btn-detail"
                    onclick="window.print()">
                <i class="fas fa-print me-2"></i>
                <span>In phi·∫øu</span>
            </button>

            <!-- N√∫t X√≥a phi·∫øu nh·∫≠p -->
            <form action="{% url 'inventory:xoa_phieu_nhap' phieu_nhap.id %}" method="post" class="d-inline m-0">
                {% csrf_token %}
                <button type="submit"
                        class="btn btn-danger d-flex align-items-center justify-content-center action-btn-detail"
                        onclick="return confirmDeleteDetail()">
                    <i class="fas fa-trash me-2"></i>
                    <span>X√≥a phi·∫øu</span>
                </button>
            </form>
        </div>
    </div>
</div>

<style>
/* CSS cho c√°c n√∫t h√†nh ƒë·ªông chi ti·∫øt - K√çCH TH∆Ø·ªöC B·∫∞NG NHAU */
.action-btn-detail {
    min-width: 140px !important;
    height: 42px !important;
    padding: 0.5rem 1rem !important;
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
    border-radius: 6px !important;
    font-weight: 500 !important;
    transition: all 0.2s ease !important;
    border-width: 1px !important;
    text-decoration: none !important;
    white-space: nowrap !important;
}

/* ƒê·∫£m b·∫£o form kh√¥ng l√†m h·ªèng layout */
form.d-inline.m-0 {
    margin: 0 !important;
    padding: 0 !important;
    display: flex !important;
}

/* M√†u s·∫Øc v√† hover effects */
.btn-outline-secondary {
    color: #6c757d !important;
    border-color: #6c757d !important;
    background-color: transparent !important;
}

.btn-outline-secondary:hover {
    background-color: #6c757d !important;
    color: white !important;
    transform: translateY(-2px) !important;
    box-shadow: 0 4px 8px rgba(108, 117, 125, 0.2) !important;
}

.btn-warning {
    background-color: #ffc107 !important;
    border-color: #ffc107 !important;
    color: #000 !important;
}

.btn-warning:hover {
    background-color: #e0a800 !important;
    border-color: #d39e00 !important;
    transform: translateY(-2px) !important;
    box-shadow: 0 4px 8px rgba(255, 193, 7, 0.3) !important;
    color: #000 !important;
}

.btn-danger {
    background-color: #dc3545 !important;
    border-color: #dc3545 !important;
    color: white !important;
}

.btn-danger:hover {
    background-color: #c82333 !important;
    border-color: #bd2130 !important;
    transform: translateY(-2px) !important;
    box-shadow: 0 4px 8px rgba(220, 53, 69, 0.3) !important;
    color: white !important;
}

/* Kho·∫£ng c√°ch gi·ªØa c√°c n√∫t */
.gap-3 {
    gap: 1rem !important;
}

/* Responsive cho mobile */
@media (max-width: 768px) {
    .action-btn-detail {
        min-width: 120px !important;
        height: 38px !important;
        padding: 0.375rem 0.75rem !important;
        font-size: 0.9rem !important;
    }

    .gap-3 {
        gap: 0.75rem !important;
    }

    .action-btn-detail i {
        margin-right: 0.5rem !important;
    }
}

@media (max-width: 576px) {
    .d-flex.justify-content-end {
        flex-direction: column !important;
        align-items: stretch !important;
        gap: 0.75rem !important;
    }

    .action-btn-detail {
        min-width: 100% !important;
        width: 100% !important;
        height: 40px !important;
        justify-content: center !important;
    }
}

/* CSS cho trang in */
@media print {
    .card-header, .btn, .navbar, .sidebar, footer,
    .d-flex.justify-content-end.mt-4.gap-3 {
        display: none !important;
    }

    .card {
        border: none !important;
        box-shadow: none !important;
    }

    .card-body {
        padding: 0 !important;
    }

    h5 {
        color: #000 !important;
    }
}
</style>

<script>
// H√†m x√°c nh·∫≠n x√≥a chi ti·∫øt
function confirmDeleteDetail() {
    const maPhieu = "{{ phieu_nhap.ma_phieu }}";
    return confirm(`B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a phi·∫øu nh·∫≠p "${maPhieu}"?\n\n‚ö†Ô∏è C·∫£nh b√°o: H√†nh ƒë·ªông n√†y s·∫Ω x√≥a t·∫•t c·∫£ s·∫£n ph·∫©m trong phi·∫øu v√† kh√¥ng th·ªÉ ho√†n t√°c!`);
}
</script>
{% endblock %}